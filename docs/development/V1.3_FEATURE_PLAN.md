# Version 1.3 Feature Development Plan

**Version:** 1.3.0 - Data Export & Gamification Release
**Target Release:** Q1 2026
**Status:** Planning Phase
**Last Updated:** 2025-12-22

---

## Table of Contents

1. [Release Overview](#release-overview)
2. [Feature 1: CSV Data Export System](#feature-1-csv-data-export-system)
3. [Feature 2: Achievement Badge System](#feature-2-achievement-badge-system)
4. [Feature 3: Multi-Teacher Hardening](#feature-3-multi-teacher-hardening)
5. [Testing Strategy](#testing-strategy)
6. [Deployment Plan](#deployment-plan)
7. [Success Metrics](#success-metrics)

---

## Release Overview

### Goals

Version 1.3 focuses on two major user-facing features and one critical infrastructure improvement:

1. **Data Export** - Enable teachers to export classroom data for external use
2. **Gamification** - Introduce achievement badges to increase student engagement
3. **Multi-Teacher Completion** - Finalize the multi-teacher architecture

### Timeline

| Phase | Duration | Dates (Estimated) |
|-------|----------|-------------------|
| Planning & Design | 2 weeks | Dec 22, 2025 - Jan 5, 2026 |
| Data Export Implementation | 3-4 weeks | Jan 6 - Feb 2, 2026 |
| Badge System Implementation | 4-6 weeks | Feb 3 - Mar 16, 2026 |
| Multi-Teacher Hardening | 2-3 weeks | Feb 3 - Feb 23, 2026 |
| Testing & QA | 2 weeks | Mar 17 - Mar 30, 2026 |
| Documentation & Release | 1 week | Mar 31 - Apr 6, 2026 |
| **Total** | **14-18 weeks** | **Q1 2026** |

*Note: Some phases will run in parallel*

---

## Feature 1: CSV Data Export System

### Overview

Teachers need the ability to export classroom data for:
- Integration with school grading systems
- Parent communication and reporting
- Record-keeping and backup
- End-of-year archival

### User Stories

**As a teacher, I want to:**
- Export my class roster with current balances (CSV)
- Export transaction history for a specific period (CSV)
- Export attendance records for grading (CSV)
- Export payroll history to verify student earnings (CSV)
- Export store purchase history to track spending (CSV)

### Technical Design

#### Database Schema
No schema changes required - export system reads existing data.

#### Export Routes

```python
# New routes in app/routes/admin.py

@admin_bp.route('/export/roster/<join_code>', methods=['GET'])
@admin_required
def export_roster(join_code):
    """Export student roster with balances"""
    pass

@admin_bp.route('/export/transactions/<join_code>', methods=['POST'])
@admin_required
def export_transactions(join_code):
    """Export transaction history with date filters"""
    pass

@admin_bp.route('/export/attendance/<join_code>', methods=['POST'])
@admin_required
def export_attendance(join_code):
    """Export attendance records"""
    pass

@admin_bp.route('/export/payroll/<join_code>', methods=['POST'])
@admin_required
def export_payroll(join_code):
    """Export payroll history"""
    pass

@admin_bp.route('/export/store/<join_code>', methods=['POST'])
@admin_required
def export_store_purchases(join_code):
    """Export store purchase history"""
    pass
```

#### CSV Format Examples

**Roster Export:**
```csv
Student Name,Username,Checking Balance,Savings Balance,Total Balance,Insurance Status,Last Active
John Doe,johnd,450.00,1200.00,1650.00,Active,2025-12-21
Jane Smith,janes,320.00,850.00,1170.00,None,2025-12-20
```

**Transaction Export:**
```csv
Date,Time,Student,Type,Amount,Description,Balance After
2025-12-21,09:15 AM,John Doe,Payroll,+50.00,Weekly attendance,500.00
2025-12-21,10:30 AM,John Doe,Purchase,-25.00,Homework Pass,475.00
```

#### Implementation Tasks

- [ ] Create `app/utils/export.py` module with export functions
- [ ] Implement CSV generation with proper escaping
- [ ] Add date range filtering for historical exports
- [ ] Implement rate limiting (max 10 exports per hour per teacher)
- [ ] Add "Export" buttons to relevant admin pages
- [ ] Create export form with date range picker
- [ ] Optional: Add encryption for sensitive exports (PII)
- [ ] Add export activity logging
- [ ] Write comprehensive tests
- [ ] Update teacher manual with export instructions

#### Security Considerations

- âœ… All exports scoped by `join_code` (multi-tenancy safe)
- âœ… Admin authentication required
- âœ… Rate limiting to prevent abuse
- âœ… PII encryption optional for sensitive data
- âœ… Export activity logged for audit trail
- âš ï¸ Consider GDPR compliance for data export (right to data portability)

#### UI/UX Design

**Export Button Placement:**
- Student Management page - "Export Roster" button
- Transactions page - "Export Transactions" button
- Attendance page - "Export Attendance" button
- Payroll page - "Export Payroll" button
- Store Management - "Export Purchases" button

**Export Modal:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Export Transaction History          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Date Range:                         â”‚
â”‚ From: [________] To: [________]     â”‚
â”‚                                     â”‚
â”‚ Format: â¦¿ CSV  â—‹ Excel             â”‚
â”‚                                     â”‚
â”‚ Include: â˜‘ Student Names            â”‚
â”‚          â˜‘ Balance Changes          â”‚
â”‚          â˜ Encrypt PII              â”‚
â”‚                                     â”‚
â”‚ [Cancel]              [Export CSV]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Feature 2: Achievement Badge System

### Overview

Gamification through achievement badges increases student engagement and teaches goal-setting. The system should be:
- **Optional** - Teachers can enable/disable per class
- **Privacy-conscious** - Leaderboards optional and anonymous
- **Educational** - Badges tied to financial literacy concepts

### User Stories

**As a student, I want to:**
- See my earned badges on my profile
- Know what badges I can earn and how
- Feel motivated by visual progress
- (Optional) See a class leaderboard

**As a teacher, I want to:**
- Enable/disable badges for my class
- Configure which badges are active
- View student badge progress
- Use badges as teaching moments for financial concepts

### Badge Categories

#### 1. Attendance Badges
- **Perfect Week** - 5 consecutive days present
- **Perfect Month** - 4 consecutive weeks present
- **Attendance Streak** - 10, 25, 50, 100 consecutive days

#### 2. Savings Badges
- **First Saver** - Made first savings deposit
- **Savings Goal** - Saved $100, $500, $1000
- **Compound Interest Master** - Earned $50 in interest

#### 3. Responsibility Badges
- **Insurance Smart** - Maintained insurance for 30 days
- **Rent Ready** - Paid rent on time 5 times in a row
- **Budget Master** - Maintained positive balance for 30 days

#### 4. Store Badges
- **Smart Shopper** - Made first purchase
- **Bulk Buyer** - Used bulk discount feature
- **Long-Term Planner** - Saved for and purchased long-term goal item

#### 5. Banking Badges
- **Balance Check** - Checked balance 10 times
- **Transfer Pro** - Made 5 peer transfers
- **Debt Free** - Paid off overdraft

### Technical Design

#### Database Schema

```python
# New models in app/models.py

class Badge(db.Model):
    """Badge definitions (system-wide)"""
    __tablename__ = 'badges'

    id = db.Column(db.Integer, primary_key=True)
    name = db.Column(db.String(100), nullable=False)  # "Perfect Week"
    description = db.Column(db.Text, nullable=False)
    category = db.Column(db.String(50), nullable=False)  # "attendance", "savings", etc.
    icon = db.Column(db.String(100))  # Icon identifier
    criteria = db.Column(db.JSON)  # JSON criteria for awarding
    points = db.Column(db.Integer, default=10)  # Optional point value
    is_active = db.Column(db.Boolean, default=True)
    created_at = db.Column(db.DateTime(timezone=True), default=lambda: datetime.now(timezone.utc))

class StudentBadge(db.Model):
    """Badges earned by students"""
    __tablename__ = 'student_badges'

    id = db.Column(db.Integer, primary_key=True)
    student_id = db.Column(db.Integer, db.ForeignKey('students.id'), nullable=False)
    badge_id = db.Column(db.Integer, db.ForeignKey('badges.id'), nullable=False)
    earned_at = db.Column(db.DateTime(timezone=True), default=lambda: datetime.now(timezone.utc))
    join_code = db.Column(db.String(20), nullable=False)  # Multi-tenancy

    # Relationships
    student = db.relationship('Student', backref='earned_badges')
    badge = db.relationship('Badge')

class BlockBadgeSettings(db.Model):
    """Per-class badge configuration"""
    __tablename__ = 'block_badge_settings'

    id = db.Column(db.Integer, primary_key=True)
    join_code = db.Column(db.String(20), nullable=False, unique=True)
    badges_enabled = db.Column(db.Boolean, default=False)
    leaderboard_enabled = db.Column(db.Boolean, default=False)
    enabled_badges = db.Column(db.JSON)  # List of badge IDs enabled for this class
```

#### Badge Awarding Logic

```python
# New module: app/utils/badges.py

def check_and_award_badges(student_id, join_code, event_type, event_data):
    """
    Check if student qualifies for new badges based on event.

    Args:
        student_id: Student ID
        join_code: Class join code
        event_type: "tap_in", "transaction", "payment", etc.
        event_data: Dict with event-specific data
    """
    settings = BlockBadgeSettings.query.filter_by(join_code=join_code).first()
    if not settings or not settings.badges_enabled:
        return

    # Check all active badges for this class
    for badge_id in settings.enabled_badges:
        badge = Badge.query.get(badge_id)
        if badge and evaluate_badge_criteria(student_id, join_code, badge, event_data):
            award_badge(student_id, badge_id, join_code)

def evaluate_badge_criteria(student_id, join_code, badge, event_data):
    """Evaluate if student meets badge criteria"""
    # Implementation based on badge.criteria JSON
    pass

def award_badge(student_id, badge_id, join_code):
    """Award badge to student"""
    # Check if already earned
    existing = StudentBadge.query.filter_by(
        student_id=student_id,
        badge_id=badge_id,
        join_code=join_code
    ).first()

    if not existing:
        student_badge = StudentBadge(
            student_id=student_id,
            badge_id=badge_id,
            join_code=join_code
        )
        db.session.add(student_badge)
        db.session.commit()
        # TODO: Trigger notification
```

#### Implementation Tasks

- [ ] Create database models and migration
- [ ] Implement badge awarding logic in `app/utils/badges.py`
- [ ] Integrate badge checks into key events (tap in, transaction, payment)
- [ ] Create badge seed data (predefined badges)
- [ ] Build student badge profile page
- [ ] Build teacher badge management page
- [ ] Create badge icons/graphics (Material Symbols or custom SVG)
- [ ] Implement badge notification system (subtle, non-intrusive)
- [ ] Build optional leaderboard view
- [ ] Add privacy controls (anonymous leaderboards)
- [ ] Write comprehensive tests
- [ ] Update student guide and teacher manual

#### UI/UX Design

**Student Badge Profile:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ My Badges                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Earned (8)          In Progress (5) â”‚
â”‚                                     â”‚
â”‚ ğŸ† Perfect Week                     â”‚
â”‚ ğŸ’° First Saver                      â”‚
â”‚ ğŸ“Š Balance Check                    â”‚
â”‚ ğŸ¯ Smart Shopper                    â”‚
â”‚                                     â”‚
â”‚ Progress Towards Next Badge:        â”‚
â”‚ â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 60% Savings Goal         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Teacher Badge Settings:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Badge System Settings               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â˜‘ Enable badges for this class      â”‚
â”‚ â˜ Enable class leaderboard          â”‚
â”‚                                     â”‚
â”‚ Active Badges:                      â”‚
â”‚ â˜‘ Attendance Badges                 â”‚
â”‚ â˜‘ Savings Badges                    â”‚
â”‚ â˜‘ Responsibility Badges             â”‚
â”‚ â˜ Store Badges                      â”‚
â”‚                                     â”‚
â”‚ [Save Settings]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Feature 3: Multi-Teacher Hardening

### Overview

Complete the transition to the `student_teachers` link table as the authoritative ownership model and deprecate the legacy `students.teacher_id` column.

### Tasks

#### 1. Audit Codebase
- [ ] Search for all `Student.query.get()` usage
- [ ] Search for all `students.teacher_id` references
- [ ] Replace with scoped helper functions
- [ ] Verify all queries properly scoped by `join_code`

#### 2. Create Runbook
- [ ] Document safe migration procedure
- [ ] Define pre-migration checks
- [ ] Define post-migration validation
- [ ] Create rollback plan

#### 3. Database Migration
- [ ] Create migration to drop `students.teacher_id`
- [ ] Add ON DELETE CASCADE safeguards
- [ ] Test migration on staging
- [ ] Validate data integrity

#### 4. Testing
- [ ] Add pytest for shared students in payroll
- [ ] Add pytest for shared students in attendance
- [ ] Add pytest for multi-period scenarios
- [ ] Verify `student_teachers` uniqueness constraint

---

## Testing Strategy

### Unit Tests
- Export functions generate correct CSV format
- Badge awarding logic evaluates criteria correctly
- Multi-tenancy scoping in all new queries

### Integration Tests
- End-to-end export flow
- Badge awarding triggers from events
- Shared student scenarios

### Manual QA
- Export data accuracy verification
- Badge UI/UX testing
- Performance testing with large datasets

### Test Coverage Goals
- Export module: 90%+ coverage
- Badge module: 85%+ coverage
- Overall project: Maintain 75%+ coverage

---

## Deployment Plan

### Phase 1: Staging Deployment
1. Deploy to staging environment
2. Run full test suite
3. Manual QA testing
4. Performance profiling

### Phase 2: Production Deployment
1. Maintenance mode announcement (48 hours notice)
2. Database backup
3. Deploy code
4. Run migrations
5. Smoke tests
6. Monitor for 24 hours

### Phase 3: Feature Rollout
1. Enable exports for all teachers
2. Badges opt-in initially (teachers enable per class)
3. Gather feedback
4. Iterate based on usage patterns

---

## Success Metrics

### Data Export
- **Adoption:** 50%+ of active teachers use export feature within first month
- **Usage:** Average 2+ exports per teacher per month
- **Performance:** Export generation < 5 seconds for most datasets
- **Errors:** < 1% error rate

### Badge System
- **Opt-in:** 30%+ of teachers enable badges within first month
- **Engagement:** 20% increase in student logins after badges enabled
- **Completion:** 50%+ of students earn at least one badge within 2 weeks
- **Feedback:** 80%+ positive teacher feedback

### Technical
- **Test Coverage:** 80%+ for new code
- **Performance:** No degradation in page load times
- **Bugs:** < 5 critical bugs in first month post-release
- **Uptime:** 99.9% during rollout

---

## Documentation Updates

### User Documentation
- [ ] Update Teacher Manual with export instructions
- [ ] Update Teacher Manual with badge system guide
- [ ] Update Student Guide with badge explanations
- [ ] Create video tutorials for new features

### Technical Documentation
- [ ] Update API reference with export endpoints
- [ ] Update database schema documentation
- [ ] Document badge awarding logic
- [ ] Update DEVELOPMENT.md

### Operations
- [ ] Create export monitoring guide
- [ ] Document badge performance optimization
- [ ] Update deployment procedures

---

## Risks & Mitigation

### Risk: Export Performance Issues
**Mitigation:**
- Implement pagination for large datasets
- Add background job processing for huge exports
- Cache frequently requested exports

### Risk: Badge System Overhead
**Mitigation:**
- Make badge checks asynchronous
- Implement efficient badge criteria evaluation
- Add database indexes for badge queries

### Risk: Teacher Adoption of Badges
**Mitigation:**
- Provide clear documentation and examples
- Create badge templates for common use cases
- Gather teacher feedback early and iterate

---

## Next Steps

1. **Week of Dec 22:** Complete technical design and get approval
2. **Week of Dec 29:** Begin export system implementation
3. **Week of Jan 5:** Begin badge system database models
4. **Week of Jan 12:** Start multi-teacher hardening audit

---

**Document Owner:** Development Team
**Last Updated:** 2025-12-22
**Status:** In Planning
