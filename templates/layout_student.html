<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% block page_icon %}school{% endblock %}
    {% set resolved_page_title = page_title or self.title() or "Student Portal" %}
    <title>{{ resolved_page_title }} - Classroom Token Hub</title>
    <meta name="csrf-token" content="{{ csrf_token() }}">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet">

    <!-- CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="{{ static_url('css/style.css') }}" rel="stylesheet">

    {% block extra_head %}{% endblock %}
</head>
<body class="student-shell">
    <aside class="student-sidebar">
        <a class="student-brand" href="{{ url_for('student.dashboard') }}">
            
            <div>
                <div> <span class="material-symbols-outlined" style="font-size: 30px; vertical-align: middle; font-weight:200">local_atm</span>Classroom</div>
                <div><span class="material-symbols-outlined" style="font-size: 30px; vertical-align: middle; font-weight:200">store</span>Token</div>
                <div> <span class="material-symbols-outlined" style="font-size: 30px; vertical-align: middle; font-weight:200"> finance_mode</span>Hub</div></div>
            </a>
        <hr>
         {% if student %}
        <div class="student-identity" style="font-size: 16px;"> Hello,
            {{ student.first_name }} {{ student.last_name }} !
        </div>
        {% endif %}
        <nav class="student-nav">
            <a href="{{ url_for('student.dashboard') }}" class="{% if request.endpoint == 'student.dashboard' %}active{% endif %}">
                <span class="material-symbols-outlined">home</span> Home
            </a>
            <a href="{{ url_for('student.transfer') }}" class="{% if request.endpoint == 'student.transfer' %}active{% endif %}">
                <span class="material-symbols-outlined">account_balance_wallet</span> Accounts
            </a>
            <a href="{{ url_for('student.shop') }}" class="{% if request.endpoint == 'student.shop' %}active{% endif %}">
                <span class="material-symbols-outlined">storefront</span> Store
            </a>
            <a href="{{ url_for('student.payroll') }}" class="{% if request.endpoint == 'student.payroll' %}active{% endif %}">
                <span class="material-symbols-outlined">credit_score</span> Work &amp; Pay
            </a>
            <a href="{{ url_for('student.rent') }}" class="{% if request.endpoint == 'student.rent' %}active{% endif %}">
                <span class="material-symbols-outlined">receipt_long</span> Bills
            </a>
            <a href="{{ url_for('student.student_insurance') }}" class="{% if request.endpoint in ['student.student_insurance','student_insurance_market','student_insurance_marketplace'] %}active{% endif %}">
                <span class="material-symbols-outlined">shield</span> Insurance
            </a>
            <a href="{{ url_for('student.help_support') }}" class="{% if request.endpoint == 'student.help_support' %}active{% endif %}">
                <span class="material-symbols-outlined">help</span> Help
            </a>
            <a href="{{ url_for('student.add_class') }}" class="{% if request.endpoint == 'student.add_class' %}active{% endif %}">
                <span class="material-symbols-outlined">group_add</span> Add Class
            </a>
            <a href="{{ url_for('student.logout') }}">
                <span class="material-symbols-outlined">logout</span> Sign Out
            </a>
        </nav>
    </aside>

    <main class="student-main">
        <div class="student-content">
            {% set resolved_page_icon = (self.page_icon() | trim) or 'school' %}
            <div class="page-header">
                <div>
                    <div class="eyebrow">Student Portal</div>
                    <h1 class="d-flex align-items-center gap-2 mb-1">
                        <span class="material-symbols-outlined">{{ resolved_page_icon }}</span>
                        {{ resolved_page_title }}
                    </h1>
                    <div class="meta" id="student-current-time"></div>
                </div>
                <div class="page-header-actions">
                    <a href="{{ url_for('student.help_support') }}" class="btn btn-white d-none d-md-inline-flex align-items-center gap-2">
                        <span class="material-symbols-outlined">help</span> Help
                    </a>
                </div>
            </div>

            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category if category != 'error' else 'danger' }} alert-dismissible fade show shadow-sm border-0 mb-4" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            {% block content %}{% endblock %}
        </div>
    </main>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ static_url('js/timezone-utils.js') }}"></script>
    <script>
        function updateStudentTime() {
            const timeElement = document.getElementById('student-current-time');
            if (!timeElement) return;
            const now = new Date();
            const optionsDate = { weekday: 'long', year: 'numeric', month: 'short', day: 'numeric' };
            const optionsTime = { hour: 'numeric', minute: 'numeric', hour12: true };
            timeElement.textContent = now.toLocaleDateString(undefined, optionsDate) + ' ' +
                                      now.toLocaleTimeString(undefined, optionsTime);
        }
        setInterval(updateStudentTime, 1000);
        updateStudentTime();
    </script>
    {% block extra_scripts %}{% endblock %}
</body>
</html>
