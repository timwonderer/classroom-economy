{% extends "base.html" %}
{% block title %}Authenticator Set Up - Teacher{% endblock %}
{% block content %}
<div class="container py-5 justify-content-center align-items-center" style="min-height: 100vh;">
  <h1 class="h3 d-block text-center mb-4 fw-bold">Set up with your authenticator</h1>
  <p >To ensure a secure account, Classroom Token Hub uses <b>time-based one-time passcode (TOTP)</b> instead of traditional passwords.</p>
      <p >You will use your <b>username</b> and a <b>6-digit code</b> generated by an authenticator app to log in each time.</p>
  <div class="w-100" style="max-width: 700px;">
    
    <div class="card shadow-sm p-4 p-md-5" style="width: 100%; margin:auto;">
      
      {% if message %}
        <div class="alert alert-danger alert-dismissible fade show mb-3 text-center py-2" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endif %}
      <div class="d-flex justify-content-center align-items-center mb-3">
        <div style="width: 48px; height: 48px; border: 2px solid #0d6efd; border-radius: 50%; display: flex; justify-content: center; align-items: center;">
          <span style="color: #0d6efd; font-size: 1.5rem; font-weight: bold;">1</span>
        </div>
      </div>
      <p>
        Scan the QR code below using your authenticator app (such as Google Authenticator, Microsoft Authenticator, Authy, 1Password, Bitwarden, or Duo Mobile).
      </p>
      <div class="d-flex justify-content-center mb-4">
        <img src="data:image/png;base64,{{ qr_b64 }}" alt="TOTP QR Code" class="rounded border shadow-sm" style="width:200px;"/>
      </div>
      <div class="mb-4 text-center">
        <span class="text-secondary small">Alternatively, enter the following code into your authenticator</span>
        <div class="d-flex justify-content-center my-2">
          <code style="font-size:14pt; padding: 0.5em 0.5em; background:rgb(237, 237, 237); border-radius: 0.5em; display: inline-block;">
            {% for c in totp_secret %}
              {% if c.isdigit() %}
                <span style="color: blue;">{{ c }}</span>
              {% else %}
                <span style="color: red;">{{ c }}</span>
              {% endif %}
            {% endfor %}
          </code>
        </div>
      </div>
      <form method="POST" autocomplete="off">
        {{ form.hidden_tag() }}
        <input type="hidden" name="username" value="{{ username }}">
        <input type="hidden" name="invite_code" value="{{ invite_code }}">
        <div class="mb-3">
          <div class="d-flex justify-content-center align-items-center mb-3">
            <div style="width: 48px; height: 48px; border: 2px solid #0d6efd; border-radius: 50%; display: flex; justify-content: center; align-items: center;">
              <span style="color: #0d6efd; font-size: 1.5rem; font-weight: bold;">2</span>
            </div>
          </div>
          <label for="totp_code"  class="form-label fw-medium text-center w-100">Enter the 6-digit code generated by your authenticator</label>
          <input
            type="text"
            id="totp_code"
            name="totp_code"
            inputmode="numeric"
            pattern="[0-9]{6}"
            maxlength="6"
            required
            autocomplete="one-time-code"
            class="form-control text-center fs-5"
          >
        </div>
        <button type="submit" class="btn btn-primary w-100 fw-semibold">
          Verify and Complete Signup
        </button>
      </form>
    </div>
  </div>
</div>
{% endblock %}
