<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Classroom Token Hub{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token() }}">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet">

    <!-- CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">

    {% block extra_head %}{% endblock %}
</head>
<body class="d-flex flex-column min-vh-100 justify-content-center align-items-center bg-light">

    <div class="container" style="max-width: 600px;">
        <div class="card shadow-lg border-0 rounded-4 overflow-hidden">
            {% block content_full %}
            <div class="card-body p-4 p-md-5">
                {% block content %}{% endblock %}
            </div>
            {% endblock %}
        </div>

        <div class="text-center mt-4">
            <a href="/sysadmin/login" class="text-secondary text-decoration-none small">System Admin Login</a>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Only run this once per session
            if (!sessionStorage.getItem('timezone_sent')) {
                const userTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                if (userTimezone) {
                    const csrfToken = document.querySelector('meta[name="csrf-token"]')?.getAttribute('content');
                    fetch('/api/set-timezone', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': csrfToken,
                        },
                        body: JSON.stringify({ timezone: userTimezone }),
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'success') {
                            sessionStorage.setItem('timezone_sent', 'true');
                        }
                    })
                    .catch(console.error);
                }
            }
        });
    </script>
    {% block extra_scripts %}{% endblock %}
</body>
</html>
