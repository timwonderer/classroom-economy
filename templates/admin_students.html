{% extends "layout_admin.html" %}
{% set page_title = "Student Overview by Block" %}
{% block title %}Student Overview by Block{% endblock %}
{% block content %}
    <div class="mb-3">

    </div>
    

    <div class="mb-3">
        <label for="block-select">Filter by Block:</label>
        <select id="block-select" onchange="changeBlock()" class="form-select mb-3" style="width: 200px;" aria-label="Select Block">
            {% for block in blocks %}
            <option value="{{ block }}" {% if block == selected_block %}selected{% endif %}>Block {{ block }}</option>
            {% endfor %}
        </select>
    </div>

    <script>
        function changeBlock() {
            
            let block = document.getElementById("block-select").value;
            window.location.href = "/admin/students?block=" + block;
        }
    </script>

    <table class="table table-bordered table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th>Name</th>
                <th>Email</th>
                <th>QR ID</th>
                <th>Passes Left</th>
                <th>Checking Balance</th>
                <th>Last Tap In</th>
                <th>Last Tap Out</th>
                <th>Reason</th>
            </tr>
        </thead>
        <tbody>
            {% for student in students %}
            <tr>
                <td>
                    <a href="{{ url_for('student_detail', student_id=student.id) }}">
                        {{ student.name }}
                    </a>
                </td>
                <td>{{ student.email or '—' }}</td>
                <td>{{ student.qr_id or '—' }}</td>
                <td>{{ student.passes_left if student.passes_left is not none else '—' }}</td>
                <td>${{ "%.2f"|format(student.checking_balance) }}</td>
                <td>
                    {% if student.last_tap_in %}
                        {{ student.last_tap_in|format_datetime }}
                    {% else %}
                        —
                    {% endif %}
                </td>
                <td>
                    {% if student.last_tap_out %}
                        {{ student.last_tap_out|format_datetime }}
                    {% else %}
                        —
                    {% endif %}
                </td>
                <td>
                  {% if student.last_tap_out_reason %}
                    {{ student.last_tap_out_reason }}
                  {% else %}
                    —
                  {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}
