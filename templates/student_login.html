<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student Login - Classroom Token Hub</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#2f4f7f">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="{{ static_url('manifest.json') }}">
    <link rel="apple-touch-icon" href="{{ static_url('images/icon-192.png') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet">
    <link href="{{ static_url('css/style.css') }}" rel="stylesheet">
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register("/sw.js")
                    .then(registration => {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }
    </script>
    <style>
        body {
            background-color: var(--background);
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }
        .auth-container {
            width: 100%;
            max-width: 900px;
            background: var(--surface);
            border-radius: 24px;
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            display: flex;
            min-height: 620px;
        }
        .auth-left {
            flex: 1;
            padding: 3rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .auth-right {
            flex: 1;
            background: linear-gradient(135deg, #2f4f7f, #1f3656);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            padding: 3rem;
            position: relative;
            overflow: hidden;
        }
        .auth-right::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        .logo-img {
            width: 360px;
            height: 360px;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }
        .pin-input {
            letter-spacing: 0.5em;
            font-family: monospace;
            text-align: center;
            font-size: 1.5rem;
            font-weight: 600;
        }
        @media (max-width: 768px) {
            .auth-container {
                flex-direction: column;
                margin: 1rem;
                min-height: auto;
            }
            .auth-right {
                display: none;
            }
            .auth-left {
                padding: 2rem;
            }
        }
    </style>
</head>
<body class="student-theme">
    <div class="auth-container">
        <div class="auth-left">
            <div class="mb-4">
                <h1 class="h3 fw-bold mb-2 text-primary">Hello, Students!</h1>
                <p class="text-secondary mb-0">Login to get started.</p>
            </div>

            {% with messages = get_flashed_messages() %}
                {% if messages %}
                    {% for message in messages %}
                    <div class="alert alert-warning border-0 shadow-sm d-flex align-items-center mb-4" role="alert">
                        <span class="material-symbols-outlined fs-5 me-2">warning</span>
                        <div>{{ message }}</div>
                    </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            <form method="POST">
                {{ form.hidden_tag() }}

                <div class="mb-3">
                    <label class="form-label small fw-bold text-secondary text-uppercase">Username</label>
                    {{ form.username(class="form-control form-control-lg", placeholder="happyramen2034MT", autocomplete="username") }}
                </div>

                <div class="mb-4">
                    <label class="form-label small fw-bold text-secondary text-uppercase">PIN </label>
                    {{ form.pin(class="form-control form-control-lg pin-input", placeholder="______", inputmode="numeric", pattern="[0-9]*", autocomplete="current-password") }}
                </div>

                {% if turnstile_site_key %}
                <div class="mb-4 d-flex justify-content-center">
                    <div class="cf-turnstile" data-sitekey="{{ turnstile_site_key }}" data-theme="light"></div>
                </div>
                {% endif %}

                {{ form.submit(class="btn btn-primary w-100 btn-lg mb-4") }}
            </form>

            <div class="text-center pt-3 border-top">
                <p class="mb-2 text-muted small">New student or account reset?</p>
                <a href="{{ url_for('student.claim_account') }}" class="btn btn-outline-primary btn-sm rounded-pill px-4 mb-3">Claim Account</a>

                <div class="d-flex gap-3 justify-content-center mb-3">
                    <a href="{{ url_for('admin.login') }}" class="text-decoration-none small text-secondary">
                        Teacher Login
                    </a>
                    <span class="text-secondary">•</span>
                    <a href="{{ url_for('admin.signup') }}" class="text-decoration-none small text-secondary">
                        Set up teacher account
                    </a>
                </div>

                <div class="d-flex gap-3 justify-content-center">
                    <a href="{{ url_for('main.privacy') }}" class="text-decoration-none small text-secondary">Privacy</a>
                    <span class="text-secondary">•</span>
                    <a href="{{ url_for('main.terms') }}" class="text-decoration-none small text-secondary">Terms</a>
                </div>
            </div>
        </div>
        <div class="auth-right">
            <img src="{{ static_url('images/2_classroom token hub 512.png') }}" alt="Student Logo" class="logo-img">
        </div>
    </div>

    <!-- Loading Tips Modal -->
    <div class="modal fade" id="loadingTipsModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg">
                <div class="modal-body text-center p-5">
                    <div class="spinner-border text-primary mb-4" role="status" style="width: 3rem; height: 3rem;">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <h5 class="fw-bold mb-3 text-primary">Did you know?</h5>
                    <p class="text-secondary mb-0" id="tipText" style="min-height: 3rem; line-height: 1.6;">
                        Loading your account...
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ static_url('js/loading_modal.js') }}"></script>
    <script>
        const studentTips = [
            "You don't have to stay logged in after starting work. You'll continue to earn minutes even when you're away from the page.",
            "Check your balance regularly to track your earnings and plan your spending wisely.",
            "Your teacher can award bonus tokens for exceptional work or good behavior.",
            "Remember to log your attendance every day to earn your payroll minutes.",
            "The shop refreshes with new items regularly - check back often for deals!",
            "Save up for big purchases by setting financial goals for yourself.",
            "Hall passes deduct from your balance - plan your breaks wisely.",
            "Insurance can protect your balance from unexpected classroom events.",
            "Ask your teacher about bonus opportunities to earn extra tokens.",
            "Keep track of your transaction history to understand your spending habits."
        ];

        document.addEventListener('DOMContentLoaded', function() {
            initLoadingModal(studentTips, {
                formId: 'loginForm',
                modalId: 'loadingTipsModal',
                tipTextId: 'tipText',
                minimumDisplayTime: 2500,
                rotationInterval: 4000
            });

            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register("/sw.js")
                        .then(registration => {
                            console.log('ServiceWorker registration successful with scope: ', registration.scope);
                        })
                        .catch(err => {
                            console.log('ServiceWorker registration failed: ', err);
                        });
                });
            }
        });
    </script>
</body>
</html>
